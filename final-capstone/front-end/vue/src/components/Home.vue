<template> <!-- HTML goes here -->
    <div id="main">
        <h1>Explore Cleveland</h1>
        <div class="destinations">
            <div class="status-message error" v-show="errorMsg != ''">{{errorMsg}}</div>
            <div class="loading" v-if="isLoading">
                <!-- We can put an image here later -->
            </div>
        <div> <!-- We need to figure out how to do a search box up here -->
            <form v-if="!isSubmitted" v-on:submit.prevent="filterDestinations">
                <input v-model="searchTerm" placeholder="Search for a landmark"/>  <!-- two-way binds to searchTerm, attach to API request -->
                <label for="SearchBy"></label>

        <select name="SearchBy" id="Search By" v-model="searchType">
            <option value="" >Search By</option>
            <option value="zipcode">Zipcode</option>
            <option value="venutype">Venu Type</option>
            <option value="name">Name</option>
            <option value="listAll">List All</option>
        </select>
                 <button>Search</button>    <!-- might need to add something here -->
                 <router-link :to="{ name: 'register' }" v-if="!this.$store.state.token">Create an account</router-link>
            </form>
            <div v-else>
            <button v-on:click="postToItinerary"> Add to Itinerary </button> 
            <select name="oneOption" id="itineraryList" v-model="selectedItinerary">
            <option v-for="itinerary in userItineraries" :key="itinerary.itineraryId" :value="itinerary.itineraryId">{{itinerary.startingPoint}}</option>
            </select>
                
                <!-- Loop through destinations array and display names after search -->
                <ul>
                    <span style="background-color:white;"></span>
                    
                    <li v-for="destination in destinations" v-bind:key="destination.destinationId">
                        <input type="checkbox" v-on:change="addToItinerary($event, destination.destinationId)"/>
                        <router-link :to="{ name: 'DestinationDetail', params: { id: destination.destinationId}}" class="destinationDetail">
                            {{ destination.name }}
                        </router-link>
                        <!-- Button to create or add to itinerary -->
                    </li>
                </ul>
                <button v-on:click="cancelSearch">Cancel</button>
            </div>
            <!--<router-link>See all landmarks</router-link> -->
    </div>
        </div>
        </div>
       <!-- <img href="https://imagesvc.meredithcorp.io/v3/mm/image?url=https%3A%2F%2Fstatic.onecms.io%2Fwp-cont[â€¦]F11%2Fskyline-cleveland-ohio-VISITCLEVELAND0917.jpg&q=85"></img> -->
</template>

<script> // Vue goes here
import DestinationService from '../services/DestinationServices';
import ItineraryServices from '../services/ItineraryServices';

export default {
    data() {
        return {
            destinations: [],
            errorMsg: '',
            searchTerm: '',
            searchType: '',
            isSubmitted: false,
            isLoading: false,
            itinerary: [],
            userItineraries: [],
            selectedItinerary: null

        }
    },
    created() {
        ItineraryServices.getItineraryById(this.$store.state.user.id).then(response => {
            this.userItineraries = response.data
        })
    },
    methods: {
        // Create method that takes the service method and sets response.data to this.destinations
        filterDestinations() {
            console.log(`searchType: ${this.searchType}`)
            // Use services to get destinations that match the searchTerm
            if (this.searchType === 'listAll') {
                DestinationService.getDestinations().then(response => {
                    this.destinations = response.data
                   // this.destinations.filter(destination => destination.name == this.searchTerm).filter(destination => destination.type == this.searchTerm) // Chain more filters here (OR statements in SQL)
                    this.isSubmitted = true;
                })
            } else if (this.searchType === 'name') {
                DestinationService.getDestinationByName(this.searchTerm).then(response => {
                    this.destinations = response.data
                    this.isSubmitted = true;
                })
            } else if (this.searchType === 'zipcode') {
                DestinationService.getDestinationByZip(this.searchTerm).then(response => {
                    this.destinations = response.data
                    this.isSubmitted = true;
                })
            }
        },
        cancelSearch() {
            this.searchTerm = '';
            this.searchType = '';
            this.isSubmitted = false;
        },

        addToItinerary(event, destinationId) {
            
            if (event.target.checked) {
                
                this.itinerary.push(destinationId);
            } else {
                this.itinerary = this.itinerary.filter(destination =>{
                    return destination !== destinationId
                })
            }
        },

        postToItinerary() {
          this.itinerary.forEach((element) => {
          ItineraryServices.addToItinerary(element, this.selectedItinerary) 
              
          });
              this.$router.push({name:"ItineraryDetail"})   


        }


    }
}
</script>

<style>  /* CSS goes here */


    #main {
        height: 100vmax;
    }
    
    label {
        color: white;
    }
    
    div.home {
        display: flex;
        flex-direction: column;
        justify-items: center;
        align-items: center;
    }

    div h1 {
        font-size: 50px;
        color: white;
        font-family: "Lucida Handwriting", cursive;
        font-size: 80px;
        display: flex;
        justify-content: center;
    }

    div.destinations {
        display: flex;
        justify-content: center;
    }

    a {
        display: flex;
        justify-content: center;
        font-weight: bold;
        color: black;
    }

    a.destinationDetail {
        color: #034f84;
        background-color: #fefbd8;
        margin-top: 5px;
        border-radius: 10px;
    }

    a:hover {
        color: RGB(73, 251, 53);
    }

    input {
        margin: 5px;
    }

    button {
        padding: 2px;
    }

    button:hover {
        color: blue;
    }

    ul {
        list-style: none;
    }

    li {
         color: white;
    }

   .select.active > span {
        background-color: white;
    }

</style>